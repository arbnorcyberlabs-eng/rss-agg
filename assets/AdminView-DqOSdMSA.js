import{_ as D,c as u,b as t,t as g,k as y,w as p,v,l as E,m as A,j as d,d as T,e as U,n as R,F as x,H as L,a as F,p as w,r as c,q as S,s as M,u as V,f as I,h as C,i as N}from"./index-DMGM6dxl.js";import{A as q}from"./LoginForm-BsI-nuFD.js";const O={name:"FeedForm",props:{feed:{type:Object,default:null}},emits:["submit","cancel"],data(){return{formData:{id:"",title:"",type:"native_rss",config:null,rss_url:null,display_order:0},configText:""}},computed:{isEdit(){return!!this.feed}},watch:{feed:{immediate:!0,handler(n){n&&(this.formData={...n},this.configText=n.config?JSON.stringify(n.config,null,2):"")}}},methods:{handleSubmit(){console.log("[FeedForm] Submit clicked",this.formData);const n={...this.formData};if(n.type="native_rss",n.config=null,!n.id||!/^[a-z0-9_\-]+$/.test(n.id)){console.warn("[FeedForm] Invalid ID"),alert("Feed ID is required (lowercase letters, numbers, dashes or underscores)");return}if(!n.title){console.warn("[FeedForm] Missing title"),alert("Title is required");return}if(!n.rss_url){console.warn("[FeedForm] Missing RSS URL"),alert("RSS Feed URL is required for native RSS feeds");return}try{new URL(n.rss_url)}catch{console.warn("[FeedForm] Invalid URL"),alert("Please provide a valid RSS feed URL");return}console.log("[FeedForm] Emitting submit",n),this.$emit("submit",n)}}},B={class:"feed-form"},H={class:"form-group"},$=["disabled"],z={class:"form-group"},j={class:"form-group"},P={key:0,class:"form-group"},Y={class:"form-group"},J={class:"form-actions"};function G(n,e,m,s,r,l){return d(),u("div",B,[t("h3",null,g(l.isEdit?"Edit Feed":"Add New Feed"),1),t("form",{onSubmit:e[7]||(e[7]=A((...o)=>l.handleSubmit&&l.handleSubmit(...o),["prevent"])),novalidate:""},[t("div",H,[e[8]||(e[8]=t("label",{for:"feedId"},"Feed ID *",-1)),p(t("input",{id:"feedId","onUpdate:modelValue":e[0]||(e[0]=o=>r.formData.id=o),type:"text",disabled:l.isEdit,placeholder:"e.g., my-feed",autocomplete:"off"},null,8,$),[[v,r.formData.id]])]),t("div",z,[e[9]||(e[9]=t("label",{for:"feedTitle"},"Title *",-1)),p(t("input",{id:"feedTitle","onUpdate:modelValue":e[1]||(e[1]=o=>r.formData.title=o),type:"text",placeholder:"e.g., My Awesome Feed",autocomplete:"off"},null,512),[[v,r.formData.title]])]),t("div",j,[e[11]||(e[11]=t("label",{for:"feedType"},"Feed Type *",-1)),p(t("select",{id:"feedType","onUpdate:modelValue":e[2]||(e[2]=o=>r.formData.type=o),required:""},[...e[10]||(e[10]=[t("option",{value:"native_rss"},"Native RSS (Existing Feed URL)",-1)])],512),[[E,r.formData.type]])]),r.formData.type==="native_rss"?(d(),u("div",P,[e[12]||(e[12]=t("label",{for:"rssUrl"},"RSS Feed URL *",-1)),p(t("input",{id:"rssUrl","onUpdate:modelValue":e[3]||(e[3]=o=>r.formData.rss_url=o),type:"url",placeholder:"https://example.com/feed.xml",autocomplete:"off"},null,512),[[v,r.formData.rss_url]])])):y("",!0),t("div",Y,[e[13]||(e[13]=t("label",{for:"displayOrder"},"Display Order",-1)),p(t("input",{id:"displayOrder","onUpdate:modelValue":e[4]||(e[4]=o=>r.formData.display_order=o),type:"number",min:"0"},null,512),[[v,r.formData.display_order,void 0,{number:!0}]])]),t("div",J,[t("button",{type:"submit",class:"submit-button",onClick:e[5]||(e[5]=(...o)=>l.handleSubmit&&l.handleSubmit(...o))},g(l.isEdit?"Update":"Create"),1),t("button",{type:"button",class:"cancel-button",onClick:e[6]||(e[6]=o=>n.$emit("cancel"))}," Cancel ")])],32)])}const K=D(O,[["render",G],["__scopeId","data-v-0126879e"]]),Q={name:"FeedManager",props:{feeds:{type:Array,default:()=>[]}},emits:["toggle","edit","delete"],methods:{handleDelete(n){confirm(`Delete feed "${n.title}"?`)&&this.$emit("delete",n.id)}}},W={class:"feed-manager"},X={class:"feed-list"},Z={class:"feed-info"},ee={class:"feed-meta"},te={class:"feed-actions"},oe=["onClick"],ne=["onClick"],se=["onClick"],re={key:0,class:"empty-state"};function de(n,e,m,s,r,l){return d(),u("div",W,[e[1]||(e[1]=t("h3",null,"Manage Feeds",-1)),t("div",X,[(d(!0),u(T,null,U(m.feeds,o=>(d(),u("div",{key:o.id,class:"feed-row"},[t("div",Z,[t("strong",null,g(o.title),1),t("span",ee,g(o.id)+" · "+g(o.type),1)]),t("div",te,[t("button",{class:R(["toggle-button",{active:o.enabled}]),onClick:f=>n.$emit("toggle",o.id,!o.enabled)},g(o.enabled?"Enabled":"Disabled"),11,oe),t("button",{class:"edit-button",onClick:f=>n.$emit("edit",o)}," Edit ",8,ne),t("button",{class:"delete-button",onClick:f=>l.handleDelete(o)}," Delete ",8,se)])]))),128))]),m.feeds.length===0?(d(),u("div",re,[...e[0]||(e[0]=[t("p",null,"No feeds yet. Create your first feed!",-1)])])):y("",!0)])}const le=D(Q,[["render",de],["__scopeId","data-v-15779aa1"]]),ie={name:"AdminView",components:{Header:L,Footer:x,AuthForm:q,FeedForm:K,FeedManager:le},setup(){N();const n=V(),e=I(),m=C(!1),s=C(null);async function r(){await n.logout()}function l(){s.value=null,m.value=!0}function o(i){s.value=i,m.value=!0}function f(){m.value=!1,s.value=null}async function _(i){try{s.value?await e.updateFeed(i.id,i):await e.addFeed(i),f()}catch(a){console.error("Error saving feed:",a),alert("Error saving feed: "+a.message)}}async function b(i,a){try{await e.toggleFeed(i,a)}catch(k){console.error("Error toggling feed:",k),alert("Error toggling feed: "+k.message)}}async function h(i){try{await e.deleteFeed(i)}catch(a){console.error("Error deleting feed:",a),alert("Error deleting feed: "+a.message)}}return n.isAuthenticated&&e.loadFeeds(),{authStore:n,feedStore:e,showForm:m,editingFeed:s,handleLogout:r,handleAdd:l,handleEdit:o,handleCancel:f,handleSubmit:_,handleToggle:b,handleDelete:h}}},ae={class:"admin-view"},ue={key:1,class:"admin-panel"},me={class:"admin-header"},fe={key:0,class:"restriction-message"},ce={key:1};function ge(n,e,m,s,r,l){const o=c("Header"),f=c("AuthForm"),_=c("router-link"),b=c("FeedForm"),h=c("FeedManager"),i=c("Footer");return d(),u("div",ae,[F(o),s.authStore.isAuthenticated?(d(),u("div",ue,[t("div",me,[e[2]||(e[2]=t("h2",null,"Feed Management",-1)),t("button",{class:"logout-button",onClick:e[0]||(e[0]=(...a)=>s.handleLogout&&s.handleLogout(...a))},"Logout")]),s.authStore.isAdmin?(d(),u("div",ce,[s.showForm?(d(),w(b,{key:0,feed:s.editingFeed,onSubmit:s.handleSubmit,onCancel:s.handleCancel},null,8,["feed","onSubmit","onCancel"])):y("",!0),s.showForm?y("",!0):(d(),u("button",{key:1,class:"add-button",onClick:e[1]||(e[1]=(...a)=>s.handleAdd&&s.handleAdd(...a))}," + Add New Feed ")),F(h,{feeds:s.feedStore.feeds,onToggle:s.handleToggle,onEdit:s.handleEdit,onDelete:s.handleDelete},null,8,["feeds","onToggle","onEdit","onDelete"])])):(d(),u("div",fe,[e[6]||(e[6]=t("p",null,"⚠️ You don't have admin access to manage feeds.",-1)),t("p",null,[e[4]||(e[4]=S("You can still customize your feed preferences in the ",-1)),F(_,{to:"/preferences"},{default:M(()=>[...e[3]||(e[3]=[S("Preferences",-1)])]),_:1}),e[5]||(e[5]=S(" page.",-1))])]))])):(d(),w(f,{key:0})),F(i)])}const Fe=D(ie,[["render",ge],["__scopeId","data-v-69ad5088"]]);export{Fe as default};
