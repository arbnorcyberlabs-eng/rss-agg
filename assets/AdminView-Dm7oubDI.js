import{_ as D,c as a,b as o,t as g,k as F,w as p,v,l as E,m as A,j as l,d as T,e as U,n as R,F as L,H as x,a as _,p as k,r as c,q as S,s as M,u as V,f as I,h as C,i as N}from"./index-DAv4eYuc.js";import{A as $}from"./LoginForm-X5JlrrkC.js";const q={name:"FeedForm",props:{feed:{type:Object,default:null}},emits:["submit","cancel"],data(){return{formData:{id:"",title:"",type:"native_rss",config:null,rss_url:null,display_order:0},configText:""}},computed:{isEdit(){return!!this.feed}},watch:{feed:{immediate:!0,handler(t){t&&(this.formData={...t},this.configText=t.config?JSON.stringify(t.config,null,2):"")}}},methods:{handleSubmit(){console.log("[FeedForm] Submit clicked",this.formData);const t={...this.formData};if(t.type="native_rss",t.config=null,typeof t.id=="string"&&(t.id=t.id.trim().toLowerCase()),typeof t.title=="string"&&(t.title=t.title.trim()),typeof t.rss_url=="string"&&(t.rss_url=t.rss_url.trim()),!t.id||!/^[a-z][a-z0-9_\-]{2,31}$/.test(t.id)){console.warn("[FeedForm] Invalid ID"),alert("Feed ID is required (start with a letter, 3-32 chars, lowercase letters, numbers, dashes or underscores)");return}if(!t.title){console.warn("[FeedForm] Missing title"),alert("Title is required");return}if(!t.rss_url){console.warn("[FeedForm] Missing RSS URL"),alert("RSS Feed URL is required for native RSS feeds");return}try{new URL(t.rss_url)}catch{console.warn("[FeedForm] Invalid URL"),alert("Please provide a valid RSS feed URL");return}console.log("[FeedForm] Emitting submit",t),this.$emit("submit",{...t})}}},O={class:"feed-form"},z={class:"form-group"},B=["disabled"],H={class:"form-group"},j={class:"form-group"},P={key:0,class:"form-group"},Y={class:"form-group"},J={class:"form-actions"},G={type:"submit",class:"submit-button"};function K(t,e,m,s,r,u){return l(),a("div",O,[o("h3",null,g(u.isEdit?"Edit Feed":"Add New Feed"),1),o("form",{onSubmit:e[6]||(e[6]=A((...n)=>u.handleSubmit&&u.handleSubmit(...n),["prevent"])),novalidate:""},[o("div",z,[e[7]||(e[7]=o("label",{for:"feedId"},"Feed ID *",-1)),p(o("input",{id:"feedId","onUpdate:modelValue":e[0]||(e[0]=n=>r.formData.id=n),type:"text",disabled:u.isEdit,placeholder:"e.g., my-feed",autocomplete:"off"},null,8,B),[[v,r.formData.id]])]),o("div",H,[e[8]||(e[8]=o("label",{for:"feedTitle"},"Title *",-1)),p(o("input",{id:"feedTitle","onUpdate:modelValue":e[1]||(e[1]=n=>r.formData.title=n),type:"text",placeholder:"e.g., My Awesome Feed",autocomplete:"off"},null,512),[[v,r.formData.title]])]),o("div",j,[e[10]||(e[10]=o("label",{for:"feedType"},"Feed Type *",-1)),p(o("select",{id:"feedType","onUpdate:modelValue":e[2]||(e[2]=n=>r.formData.type=n),required:""},[...e[9]||(e[9]=[o("option",{value:"native_rss"},"Native RSS (Existing Feed URL)",-1)])],512),[[E,r.formData.type]])]),r.formData.type==="native_rss"?(l(),a("div",P,[e[11]||(e[11]=o("label",{for:"rssUrl"},"RSS Feed URL *",-1)),p(o("input",{id:"rssUrl","onUpdate:modelValue":e[3]||(e[3]=n=>r.formData.rss_url=n),type:"url",placeholder:"https://example.com/feed.xml",autocomplete:"off"},null,512),[[v,r.formData.rss_url]])])):F("",!0),o("div",Y,[e[12]||(e[12]=o("label",{for:"displayOrder"},"Display Order",-1)),p(o("input",{id:"displayOrder","onUpdate:modelValue":e[4]||(e[4]=n=>r.formData.display_order=n),type:"number",min:"0"},null,512),[[v,r.formData.display_order,void 0,{number:!0}]])]),o("div",J,[o("button",G,g(u.isEdit?"Update":"Create"),1),o("button",{type:"button",class:"cancel-button",onClick:e[5]||(e[5]=n=>t.$emit("cancel"))}," Cancel ")])],32)])}const Q=D(q,[["render",K],["__scopeId","data-v-ce031ef3"]]),W={name:"FeedManager",props:{feeds:{type:Array,default:()=>[]}},emits:["toggle","edit","delete"],methods:{handleDelete(t){confirm(`Delete feed "${t.title}"?`)&&this.$emit("delete",t.id)}}},X={class:"feed-manager"},Z={class:"feed-list"},ee={class:"feed-info"},te={class:"feed-meta"},oe={class:"feed-actions"},ne=["onClick"],se=["onClick"],re=["onClick"],le={key:0,class:"empty-state"};function ie(t,e,m,s,r,u){return l(),a("div",X,[e[1]||(e[1]=o("h3",null,"Manage Feeds",-1)),o("div",Z,[(l(!0),a(T,null,U(m.feeds,n=>(l(),a("div",{key:n.id,class:"feed-row"},[o("div",ee,[o("strong",null,g(n.title),1),o("span",te,g(n.id)+" · "+g(n.type),1)]),o("div",oe,[o("button",{class:R(["toggle-button",{active:n.enabled}]),onClick:f=>t.$emit("toggle",n.id,!n.enabled)},g(n.enabled?"Enabled":"Disabled"),11,ne),o("button",{class:"edit-button",onClick:f=>t.$emit("edit",n)}," Edit ",8,se),o("button",{class:"delete-button",onClick:f=>u.handleDelete(n)}," Delete ",8,re)])]))),128))]),m.feeds.length===0?(l(),a("div",le,[...e[0]||(e[0]=[o("p",null,"No feeds yet. Create your first feed!",-1)])])):F("",!0)])}const de=D(W,[["render",ie],["__scopeId","data-v-15779aa1"]]),ae={name:"AdminView",components:{Header:x,Footer:L,AuthForm:$,FeedForm:Q,FeedManager:de},setup(){N();const t=V(),e=I(),m=C(!1),s=C(null);async function r(){await t.logout()}function u(){s.value=null,m.value=!0}function n(i){s.value=i,m.value=!0}function f(){m.value=!1,s.value=null}async function y(i){try{console.log("[Admin] handleSubmit received",i),s.value?await e.updateFeed(i.id,i):await e.addFeed(i),await e.loadFeeds(),f()}catch(d){console.error("Error saving feed:",d),alert("Error saving feed: "+d.message)}}async function h(i,d){try{await e.toggleFeed(i,d)}catch(w){console.error("Error toggling feed:",w),alert("Error toggling feed: "+w.message)}}async function b(i){try{await e.deleteFeed(i)}catch(d){console.error("Error deleting feed:",d),alert("Error deleting feed: "+d.message)}}return t.isAuthenticated&&e.loadFeeds(),{authStore:t,feedStore:e,showForm:m,editingFeed:s,handleLogout:r,handleAdd:u,handleEdit:n,handleCancel:f,handleSubmit:y,handleToggle:h,handleDelete:b}}},ue={class:"admin-view"},me={key:1,class:"admin-panel"},fe={class:"admin-header"},ce={key:0,class:"restriction-message"},ge={key:1};function pe(t,e,m,s,r,u){const n=c("Header"),f=c("AuthForm"),y=c("router-link"),h=c("FeedForm"),b=c("FeedManager"),i=c("Footer");return l(),a("div",ue,[_(n),s.authStore.isAuthenticated?(l(),a("div",me,[o("div",fe,[e[2]||(e[2]=o("h2",null,"Feed Management",-1)),o("button",{class:"logout-button",onClick:e[0]||(e[0]=(...d)=>s.handleLogout&&s.handleLogout(...d))},"Logout")]),s.authStore.isAdmin?(l(),a("div",ge,[s.showForm?(l(),k(h,{key:0,feed:s.editingFeed,onSubmit:s.handleSubmit,onCancel:s.handleCancel},null,8,["feed","onSubmit","onCancel"])):F("",!0),s.showForm?F("",!0):(l(),a("button",{key:1,class:"add-button",onClick:e[1]||(e[1]=(...d)=>s.handleAdd&&s.handleAdd(...d))}," + Add New Feed ")),_(b,{feeds:s.feedStore.feeds,onToggle:s.handleToggle,onEdit:s.handleEdit,onDelete:s.handleDelete},null,8,["feeds","onToggle","onEdit","onDelete"])])):(l(),a("div",ce,[e[6]||(e[6]=o("p",null,"⚠️ You don't have admin access to manage feeds.",-1)),o("p",null,[e[4]||(e[4]=S("You can still customize your feed preferences in the ",-1)),_(y,{to:"/preferences"},{default:M(()=>[...e[3]||(e[3]=[S("Preferences",-1)])]),_:1}),e[5]||(e[5]=S(" page.",-1))])]))])):(l(),k(f,{key:0})),_(i)])}const Fe=D(ae,[["render",pe],["__scopeId","data-v-b73462a3"]]);export{Fe as default};
