<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Tests</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .pass { background: #d4edda; border-color: #c3e6cb; }
        .fail { background: #f8d7da; border-color: #f5c6cb; }
        .running { background: #fff3cd; border-color: #ffeaa7; }
    </style>
</head>
<body>
    <h1>Phase 3 Service Tests</h1>
    <div id="results"></div>
    
    <script type="module">
        const results = document.getElementById('results');
        
        function addTest(name, status, message) {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `<strong>${name}:</strong> ${message}`;
            results.appendChild(div);
        }

        // Test 1: Supabase Connection
        addTest('Supabase Connection', 'running', 'Testing...');
        try {
            const { createClient } = await import('@supabase/supabase-js');
            const supabaseUrl = 'https://godeglzovkxzhwxyxbdd.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdvZGVnbHpvdmt4emh3eHl4YmRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwNDE2ODAsImV4cCI6MjA3NjYxNzY4MH0.VJ8rpKqRkWyL6DYiViV6_MLdyhkWweUPcSHcPuvmVXg';
            const supabase = createClient(supabaseUrl, supabaseKey);
            
            const { data, error } = await supabase.from('feeds').select('count');
            if (error) throw error;
            
            addTest('Supabase Connection', 'pass', `Connected! Feed count query successful`);
        } catch (e) {
            addTest('Supabase Connection', 'fail', e.message);
        }

        // Test 2: Feed Service - Fetch Feeds
        addTest('Feed Service - fetchFeeds()', 'running', 'Testing...');
        try {
            const { fetchFeeds } = await import('./src/services/feedService.js');
            const feeds = await fetchFeeds();
            
            if (feeds.length === 5) {
                addTest('Feed Service - fetchFeeds()', 'pass', `Fetched ${feeds.length} feeds successfully`);
            } else {
                addTest('Feed Service - fetchFeeds()', 'fail', `Expected 5 feeds, got ${feeds.length}`);
            }
        } catch (e) {
            addTest('Feed Service - fetchFeeds()', 'fail', e.message);
        }

        // Test 3: XML Parser - Sample RSS
        addTest('XML Parser - RSS', 'running', 'Testing...');
        try {
            const { parseFeed } = await import('./src/services/xmlParser.js');
            const sampleRSS = `<?xml version="1.0"?>
                <rss version="2.0">
                    <channel>
                        <title>Test Feed</title>
                        <item>
                            <title>Test Item</title>
                            <link>https://example.com/test</link>
                            <description>Test description</description>
                            <pubDate>Mon, 21 Oct 2024 12:00:00 GMT</pubDate>
                        </item>
                    </channel>
                </rss>`;
            
            const result = parseFeed(sampleRSS);
            if (result.items.length === 1 && result.items[0].title === 'Test Item') {
                addTest('XML Parser - RSS', 'pass', 'RSS parsing successful');
            } else {
                addTest('XML Parser - RSS', 'fail', 'Parsed data doesn\'t match expected');
            }
        } catch (e) {
            addTest('XML Parser - RSS', 'fail', e.message);
        }

        // Test 4: XML Parser - Sample Atom
        addTest('XML Parser - Atom', 'running', 'Testing...');
        try {
            const { parseFeed } = await import('./src/services/xmlParser.js');
            const sampleAtom = `<?xml version="1.0"?>
                <feed xmlns="http://www.w3.org/2005/Atom">
                    <title>Test Feed</title>
                    <entry>
                        <title>Test Entry</title>
                        <link href="https://example.com/test"/>
                        <summary>Test summary</summary>
                        <published>2024-10-21T12:00:00Z</published>
                    </entry>
                </feed>`;
            
            const result = parseFeed(sampleAtom);
            if (result.isAtom && result.items.length === 1 && result.items[0].title === 'Test Entry') {
                addTest('XML Parser - Atom', 'pass', 'Atom parsing successful');
            } else {
                addTest('XML Parser - Atom', 'fail', 'Parsed data doesn\'t match expected');
            }
        } catch (e) {
            addTest('XML Parser - Atom', 'fail', e.message);
        }

        // Test 5: Source Detection
        addTest('XML Parser - Source Detection', 'running', 'Testing...');
        try {
            const { detectFeedSource } = await import('./src/services/xmlParser.js');
            const tests = [
                ['https://www.youtube.com/watch?v=123', 'youtube'],
                ['https://en.wikipedia.org/wiki/Test', 'wikipedia'],
                ['https://news.ycombinator.com/item?id=123', 'hackernews'],
                ['https://medium.com/@user/article', 'medium']
            ];
            
            let allPassed = true;
            for (const [url, expected] of tests) {
                if (detectFeedSource(url) !== expected) {
                    allPassed = false;
                    break;
                }
            }
            
            if (allPassed) {
                addTest('XML Parser - Source Detection', 'pass', 'All source detections correct');
            } else {
                addTest('XML Parser - Source Detection', 'fail', 'Some source detections failed');
            }
        } catch (e) {
            addTest('XML Parser - Source Detection', 'fail', e.message);
        }

        console.log('Phase 3 Service Tests Complete');
    </script>
</body>
</html>

